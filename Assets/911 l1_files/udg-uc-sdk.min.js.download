let srcPds = 'https://www.porsche.com/all/usercentrics/udg-uc-sdk-pds.min.js';
const srcLegacy = 'https://www.porsche.com/all/usercentrics/udg-uc-sdk-legacy.min.js';
const urlsPdsBlacklist = ['//www.overtake.gg','//overtake.gg','//customer.drive.porsche.com','//www.porscheclubnews.com','//porscheclubnews.com'];
const urlsPdsPreview = [];
let onPdsBlacklist = false;

urlsPdsBlacklist.every(function (url) {
  if (window.location.href.indexOf(url) > -1) {
    onPdsBlacklist = true;
    return false;
  }
  return true;
});

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
if(urlParams.get('uc-no-blacklist') === 'true' || window.location.hash.includes('#uc-no-blacklist=true')) {
	onPdsBlacklist = false;
}
if(urlParams.get('uc-local') === 'true' || window.location.hash.includes('#uc-local=true')) {
	onPdsBlacklist = false;
	srcPds = 'http://localhost:8000/udg-uc-sdk-pds.js';
}
if(urlsPdsPreview.some((url) => window.location.href.indexOf(url) >= 0) || urlParams.get('uc-preview') === 'true' || window.location.hash.includes('#uc-preview=true')) {
	onPdsBlacklist = false;
	srcPds = 'https://www.porsche.com/all/usercentrics/udg-uc-sdk-pds-preview.min.js';
}
if((urlParams.get('uc-poc') === 'true' || window.location.hash.includes('#uc-poc=true')) && `${window.location.hostname}${window.location.pathname}`.startsWith('dealer.porsche.com/de/')) {
  document.querySelector('script[src*="udg-uc-sdk."]')?.setAttribute('id', 'mpbrDPGGGPrtw5');
	srcPds = 'https://www.porsche.com/all/usercentrics/udg-uc-sdk-pds-poc.min.js';
}

if (!onPdsBlacklist) {	
  if (document.readyState !== "loading") {
	const sdkScriptElement = document.createElement('script');
	sdkScriptElement.type = 'text/javascript';
	sdkScriptElement.src = srcPds;
	document.body.appendChild(sdkScriptElement);
  } else {
	document.addEventListener("DOMContentLoaded", function (event) {
	  const sdkScriptElement = document.createElement('script');
	  sdkScriptElement.type = 'text/javascript';
	  sdkScriptElement.src = srcPds;
	  document.body.appendChild(sdkScriptElement);
	});
  }  
}  
else {
  if (document.readyState !== "loading") {
	const sdkScriptElement = document.createElement('script');
	sdkScriptElement.type = 'text/javascript';
	sdkScriptElement.src = srcLegacy;
	document.body.appendChild(sdkScriptElement);
  } else {
	document.addEventListener("DOMContentLoaded", function (event) {
	  const sdkScriptElement = document.createElement('script');
	  sdkScriptElement.type = 'text/javascript';
	  sdkScriptElement.src = srcLegacy;
	  document.body.appendChild(sdkScriptElement);
	});
  } 
}